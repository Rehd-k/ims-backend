'use strict';const a34_0x533531=a34_0xa8f2;(function(_0x5ce354,_0x23ab1d){const _0x534ee4=a34_0xa8f2,_0x16525c=_0x5ce354();while(!![]){try{const _0x6d1bfe=parseInt(_0x534ee4(0xef))/0x1*(parseInt(_0x534ee4(0xdc))/0x2)+parseInt(_0x534ee4(0xe4))/0x3*(-parseInt(_0x534ee4(0xec))/0x4)+parseInt(_0x534ee4(0xfa))/0x5+parseInt(_0x534ee4(0xea))/0x6+parseInt(_0x534ee4(0xfe))/0x7*(-parseInt(_0x534ee4(0xe8))/0x8)+-parseInt(_0x534ee4(0xfc))/0x9*(parseInt(_0x534ee4(0xe6))/0xa)+parseInt(_0x534ee4(0xdb))/0xb*(-parseInt(_0x534ee4(0xd1))/0xc);if(_0x6d1bfe===_0x23ab1d)break;else _0x16525c['push'](_0x16525c['shift']());}catch(_0x247e8d){_0x16525c['push'](_0x16525c['shift']());}}}(a34_0x2d59,0x9d050));var __decorate=this&&this[a34_0x533531(0xe9)]||function(_0x1e381d,_0x5454e0,_0x2a4517,_0x500308){const _0x4df7d6=a34_0x533531,_0x137763={'RJXZs':function(_0x221074,_0x379433){return _0x221074===_0x379433;},'kfDsB':function(_0x41198c,_0x3ba723){return _0x41198c<_0x3ba723;},'wNDCU':function(_0x44c8c4,_0x463836,_0x3d313a){return _0x44c8c4(_0x463836,_0x3d313a);}};var _0xb4087d=arguments['length'],_0x511887=_0xb4087d<0x3?_0x5454e0:_0x137763['RJXZs'](_0x500308,null)?_0x500308=Object['getOwnPropertyDescriptor'](_0x5454e0,_0x2a4517):_0x500308,_0xa85770;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x511887=Reflect['decorate'](_0x1e381d,_0x5454e0,_0x2a4517,_0x500308);else{for(var _0x514e1b=_0x1e381d['length']-0x1;_0x514e1b>=0x0;_0x514e1b--)if(_0xa85770=_0x1e381d[_0x514e1b])_0x511887=(_0x137763['kfDsB'](_0xb4087d,0x3)?_0xa85770(_0x511887):_0xb4087d>0x3?_0xa85770(_0x5454e0,_0x2a4517,_0x511887):_0x137763['wNDCU'](_0xa85770,_0x5454e0,_0x2a4517))||_0x511887;}return _0xb4087d>0x3&&_0x511887&&Object[_0x4df7d6(0xde)](_0x5454e0,_0x2a4517,_0x511887),_0x511887;},__metadata=this&&this['__metadata']||function(_0x3bb6f5,_0x4d5b87){const _0x41b552=a34_0x533531,_0x17010a={'PzgYJ':function(_0x475c6f,_0x5f5645){return _0x475c6f===_0x5f5645;},'Nreiq':function(_0x28111b,_0x216239){return _0x28111b===_0x216239;},'vrHxd':'function'};if(_0x17010a['PzgYJ'](typeof Reflect,_0x41b552(0xf7))&&_0x17010a[_0x41b552(0xed)](typeof Reflect['metadata'],_0x17010a['vrHxd']))return Reflect['metadata'](_0x3bb6f5,_0x4d5b87);},__param=this&&this[a34_0x533531(0xe0)]||function(_0x51cf74,_0x37fc37){return function(_0x1414a1,_0x3a1ce0){_0x37fc37(_0x1414a1,_0x3a1ce0,_0x51cf74);};};Object['defineProperty'](exports,a34_0x533531(0xf3),{'value':!![]}),exports[a34_0x533531(0xe3)]=void 0x0;function a34_0xa8f2(_0xd6ac2a,_0x4d4a12){const _0x2d590a=a34_0x2d59();return a34_0xa8f2=function(_0xa8f2e2,_0x5cabe7){_0xa8f2e2=_0xa8f2e2-0xd1;let _0xee7d3=_0x2d590a[_0xa8f2e2];return _0xee7d3;},a34_0xa8f2(_0xd6ac2a,_0x4d4a12);}const common_1=require('@nestjs/common'),mongoose_1=require('@nestjs/mongoose'),mongoose_2=require(a34_0x533531(0x100)),customer_schema_1=require('./customer.schema'),console_1=require(a34_0x533531(0xff)),do_logger_1=require('../do_logger');function a34_0x2d59(){const _0x3c79ad=['2ldDjRZ','findById','defineProperty','save','__param','design:paramtypes','customerModel','CustomerService','28677HxWARf','InjectModel','460xPWAjf','Error\x20returning\x20an\x20order:\x20','56pniWQw','__decorate','2917008HaBbDg','PNTrw','68YzFBIz','Nreiq','push','700185DwjkWB','findOne','parse','Model','__esModule','limit','BadRequestException','log','object','ERROR','sort','5993990gjonbI','error','7794XGZhmr','nameOrPhonenumber','538433LTAcAM','console','mongoose','35652IXtWTl','Injectable','hasOwnProperty','Customer\x20not\x20found','initiator','updateCustomer','name','getAllCustomers','error\x20deleting\x20customers\x20','user','3707czLyxR'];a34_0x2d59=function(){return _0x3c79ad;};return a34_0x2d59();}let CustomerService=class CustomerService{constructor(_0x17b95a){const _0x3603f6=a34_0x533531;this[_0x3603f6(0xe2)]=_0x17b95a;}async['createCustomer'](_0x2f6fb8,_0x212a8a){const _0x12a373=a34_0x533531;try{const _0x113fcc=new this[(_0x12a373(0xe2))](_0x2f6fb8);if(_0x113fcc['email']){const _0x36129c=await this['customerModel'][_0x12a373(0xf0)]({'email':_0x113fcc['email']});if(_0x36129c)throw Error('Email\x20Already\x20Exists');}return _0x113fcc[_0x12a373(0xd5)]=_0x212a8a[_0x12a373(0xda)]['username'],_0x113fcc[_0x12a373(0xdf)]();}catch(_0x42bc82){(0x0,do_logger_1['log'])('Error\x20create\x20new\x20\x20\x20cusomter:\x20'+_0x42bc82,_0x12a373(0xf8));throw new common_1['BadRequestException'](_0x42bc82);}}async[a34_0x533531(0xd8)](_0x260008,_0x1a379a){const _0x320dc4=a34_0x533531,{filter:filter='{}',sort:sort='{}',skip:skip=0x0,select:select=''}=_0x260008,_0xcb3e34=JSON['parse'](filter),_0x3d942e=JSON[_0x320dc4(0xf1)](sort);if(_0xcb3e34['nameOrPhonenumber']){const _0x1907b8=_0xcb3e34[_0x320dc4(0xfd)];_0xcb3e34['$or']=[{'name':{'$regex':new RegExp(_0x1907b8,'i')}},{'phone_number':{'$regex':new RegExp(_0x1907b8,'i')}}],delete _0xcb3e34[_0x320dc4(0xfd)];}try{return await this['customerModel']['find'](_0xcb3e34)[_0x320dc4(0xf9)](_0x3d942e)[_0x320dc4(0xf4)](0xa)['skip'](Number(skip))['select'](select)['exec']();}catch(_0xee10d5){(0x0,do_logger_1['log'])('Error\x20getting\x20all\x20\x20\x20cusomter:\x20'+_0xee10d5,'ERROR');throw new common_1[(_0x320dc4(0xf5))](_0xee10d5);}}async['addOrder'](_0x342412,_0x164174,_0x424bbe){const _0x50ca32=a34_0x533531;try{const _0x2ec658=await this[_0x50ca32(0xe2)]['findById'](_0x342412);if(!_0x2ec658)throw new common_1['BadRequestException'](_0x50ca32(0xd4));_0x2ec658['orders'][_0x50ca32(0xee)](_0x164174),_0x2ec658['total_spent']+=_0x424bbe,await _0x2ec658['save']();}catch(_0x5c1223){(0x0,do_logger_1[_0x50ca32(0xf6)])('Error\x20creating\x20order:\x20'+_0x5c1223,_0x50ca32(0xf8));throw new common_1['BadRequestException'](_0x5c1223);}}async['addReturns'](_0x5105a7,_0x5c2956){const _0xc41b24=a34_0x533531,_0x535a17={'PNTrw':'Customer\x20not\x20found'};try{const _0x3933e8=await this['customerModel'][_0xc41b24(0xdd)](_0x5105a7);if(!_0x3933e8)throw new common_1['BadRequestException'](_0x535a17[_0xc41b24(0xeb)]);_0x3933e8['returns'][_0xc41b24(0xee)](_0x5c2956),await _0x3933e8[_0xc41b24(0xdf)]();}catch(_0x38c83b){(0x0,do_logger_1['log'])('Error\x20returning\x20an\x20order:\x20'+_0x38c83b,'ERROR');throw new common_1['BadRequestException'](_0x38c83b);}}async['getCustomerDetails'](_0x49a46f){const _0x9bd0c1=a34_0x533531;try{return this[_0x9bd0c1(0xe2)][_0x9bd0c1(0xdd)](_0x49a46f)['populate']('orders.returns')['exec']();}catch(_0x5abe41){(0x0,do_logger_1['log'])(_0x9bd0c1(0xe7)+_0x5abe41,_0x9bd0c1(0xf8));throw new common_1['BadRequestException'](_0x5abe41);}}async[a34_0x533531(0xd6)](_0x2054bc,_0x5dcc84){const _0x95493f=a34_0x533531,_0x288ea2={'SIbYj':_0x95493f(0xf8)},_0x26ac0b=await this['customerModel'][_0x95493f(0xdd)](_0x2054bc);if(!_0x26ac0b){(0x0,do_logger_1[_0x95493f(0xf6)])(_0x95493f(0xd4),_0x288ea2['SIbYj']);throw new common_1['BadRequestException'](console_1[_0x95493f(0xfb)]);}try{for(const _0x4d08ad in _0x5dcc84){if(_0x5dcc84['hasOwnProperty'](_0x4d08ad)){if(_0x4d08ad==='increase'||_0x4d08ad==='decrease')for(const _0x1dcb06 in _0x5dcc84[_0x4d08ad]){if(_0x5dcc84[_0x4d08ad][_0x95493f(0xd3)](_0x1dcb06)){if(_0x4d08ad==='increase')_0x26ac0b[_0x1dcb06]+=_0x5dcc84[_0x4d08ad][_0x1dcb06];else _0x4d08ad==='decrease'&&(_0x26ac0b[_0x1dcb06]-=_0x5dcc84[_0x4d08ad][_0x1dcb06]);}}else _0x26ac0b[_0x4d08ad]=_0x5dcc84[_0x4d08ad];}}return _0x26ac0b[_0x95493f(0xdf)]();}catch(_0x55dae4){(0x0,do_logger_1[_0x95493f(0xf6)])('error\x20updating\x20customers\x20'+_0x55dae4,_0x95493f(0xf8));throw new common_1[(_0x95493f(0xf5))](_0x55dae4);}}async['deleteCustomer'](_0x2487a9){const _0x141174=a34_0x533531;try{return this['customerModel']['findByIdAndDelete'](_0x2487a9)['exec']();}catch(_0x122126){(0x0,do_logger_1['log'])(_0x141174(0xd9)+_0x122126,'ERROR');throw new common_1['BadRequestException'](_0x122126);}}};exports['CustomerService']=CustomerService,exports[a34_0x533531(0xe3)]=CustomerService=__decorate([(0x0,common_1[a34_0x533531(0xd2)])(),__param(0x0,(0x0,mongoose_1[a34_0x533531(0xe5)])(customer_schema_1['Customer'][a34_0x533531(0xd7)])),__metadata(a34_0x533531(0xe1),[mongoose_2[a34_0x533531(0xf2)]])],CustomerService);