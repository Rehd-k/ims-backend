'use strict';function a50_0x2f99(_0x4f706b,_0x564dd1){const _0x36e924=a50_0x36e9();return a50_0x2f99=function(_0x2f99b3,_0x5d7d21){_0x2f99b3=_0x2f99b3-0xaf;let _0x5dc704=_0x36e924[_0x2f99b3];return _0x5dc704;},a50_0x2f99(_0x4f706b,_0x564dd1);}const a50_0x1db781=a50_0x2f99;(function(_0x465156,_0x44e6bd){const _0x32a88a=a50_0x2f99,_0x10f07c=_0x465156();while(!![]){try{const _0x3f37cf=-parseInt(_0x32a88a(0xda))/0x1*(parseInt(_0x32a88a(0xc6))/0x2)+parseInt(_0x32a88a(0xee))/0x3*(parseInt(_0x32a88a(0xd1))/0x4)+parseInt(_0x32a88a(0xd3))/0x5*(parseInt(_0x32a88a(0xb3))/0x6)+-parseInt(_0x32a88a(0xbe))/0x7+-parseInt(_0x32a88a(0xd6))/0x8+-parseInt(_0x32a88a(0xc1))/0x9+parseInt(_0x32a88a(0xba))/0xa*(parseInt(_0x32a88a(0xc4))/0xb);if(_0x3f37cf===_0x44e6bd)break;else _0x10f07c['push'](_0x10f07c['shift']());}catch(_0x1a4361){_0x10f07c['push'](_0x10f07c['shift']());}}}(a50_0x36e9,0xb2a94));function a50_0x36e9(){const _0x57f838=['__esModule','logAction','./invoice.schema','Invoice\x20not\x20found','userId','findOne','234','Create\x20Invoice','321UDJlDO','customer','mongoose','Update\x20Invoice','UpkyC','__decorate','function','substring','invoiceModel','$regex','name','Error\x20fetching\x20invoices:\x20','18yYrOAK','find','Created\x20Invoice\x20for\x20user\x20with\x20id\x20','decorate','__metadata','Updated\x20Invoice\x20with\x20id\x20','log','40UBQypg','Error\x20updating\x20invoices:\x20','ERROR','@c.us','3933629iMZUyi','length','sort','3103740OkGVcs','populate','user','4136011IGlptm','eJGet','666noCfkn','Model','startsWith','forEach','@nestjs/mongoose','Remove\x20Invoice','create','findAll','sendMessage','initiator','Error\x20updating\x20one\x20invoice:\x20','19164sZnvwR','object','1387185ygpnTi','skip','remove','7282528Dnijcd','defineProperty','jKuRI','parse','901nsBpBk','Error\x20removing\x20one\x20invoice:\x20','location','InvoiceService','Error\x20fetching\x20one\x20invoice:\x20','AZHNL','logService','username','../do_logger','metadata','message','JMuiq'];a50_0x36e9=function(){return _0x57f838;};return a50_0x36e9();}var __decorate=this&&this[a50_0x1db781(0xf3)]||function(_0x50ed0a,_0x3b745e,_0x1cde66,_0x473ca5){const _0x126c4c=a50_0x1db781,_0x1c564b={'UpkyC':function(_0x5d7f23,_0x481f14){return _0x5d7f23<_0x481f14;}};var _0xc3b40e=arguments[_0x126c4c(0xbf)],_0x5890e2=_0xc3b40e<0x3?_0x3b745e:_0x473ca5===null?_0x473ca5=Object['getOwnPropertyDescriptor'](_0x3b745e,_0x1cde66):_0x473ca5,_0x530222;if(typeof Reflect===_0x126c4c(0xd2)&&typeof Reflect[_0x126c4c(0xb6)]===_0x126c4c(0xf4))_0x5890e2=Reflect[_0x126c4c(0xb6)](_0x50ed0a,_0x3b745e,_0x1cde66,_0x473ca5);else{for(var _0x5eb5fd=_0x50ed0a[_0x126c4c(0xbf)]-0x1;_0x5eb5fd>=0x0;_0x5eb5fd--)if(_0x530222=_0x50ed0a[_0x5eb5fd])_0x5890e2=(_0x1c564b[_0x126c4c(0xf2)](_0xc3b40e,0x3)?_0x530222(_0x5890e2):_0xc3b40e>0x3?_0x530222(_0x3b745e,_0x1cde66,_0x5890e2):_0x530222(_0x3b745e,_0x1cde66))||_0x5890e2;}return _0xc3b40e>0x3&&_0x5890e2&&Object[_0x126c4c(0xd7)](_0x3b745e,_0x1cde66,_0x5890e2),_0x5890e2;},__metadata=this&&this[a50_0x1db781(0xb7)]||function(_0x5087d3,_0x3c1193){const _0x22c0ff=a50_0x1db781,_0x33a2ed={'AZHNL':'object','HpSws':'function'};if(typeof Reflect===_0x33a2ed[_0x22c0ff(0xdf)]&&typeof Reflect[_0x22c0ff(0xe3)]===_0x33a2ed['HpSws'])return Reflect['metadata'](_0x5087d3,_0x3c1193);},__param=this&&this['__param']||function(_0x2d6818,_0x391918){return function(_0x1d464e,_0x4b3972){_0x391918(_0x1d464e,_0x4b3972,_0x2d6818);};};Object['defineProperty'](exports,a50_0x1db781(0xe6),{'value':!![]}),exports[a50_0x1db781(0xdd)]=void 0x0;const common_1=require('@nestjs/common'),mongoose_1=require(a50_0x1db781(0xca)),invoice_schema_1=require(a50_0x1db781(0xe8)),mongoose_2=require(a50_0x1db781(0xf0)),activity_service_1=require('../activity/activity.service'),do_logger_1=require(a50_0x1db781(0xe2));let InvoiceService=class InvoiceService{constructor(_0x9015e0,_0x14daf2){const _0x146a89=a50_0x1db781;this[_0x146a89(0xaf)]=_0x9015e0,this['logService']=_0x14daf2;}async[a50_0x1db781(0xcc)](_0x26d1e0,_0x15bf6e){const _0x289e0c=a50_0x1db781,_0x216250={'jKuRI':'location'};try{_0x26d1e0[_0x289e0c(0xcf)]=_0x15bf6e[_0x289e0c(0xc3)]['username'],_0x26d1e0[_0x216250[_0x289e0c(0xd8)]]=_0x15bf6e['user']['location'];const _0x3a1310=await this['invoiceModel'][_0x289e0c(0xcc)](_0x26d1e0);return this['logService']['logAction'](_0x15bf6e['user']['userId'],_0x15bf6e['user'][_0x289e0c(0xe1)],_0x289e0c(0xed),_0x289e0c(0xb5)+_0x3a1310[_0x289e0c(0xef)]),_0x3a1310;}catch(_0x5a970a){(0x0,do_logger_1['log'])('error\x20creating\x20\x20invoice\x20'+_0x5a970a,'ERROR');throw new common_1['BadRequestException'](_0x5a970a);}}async[a50_0x1db781(0xcd)](_0x5233f2,_0x5052a9){const _0x5053e9=a50_0x1db781,_0x33907e={'IWoGZ':'$or','lRibH':function(_0x47dca0,_0x464cb6){return _0x47dca0(_0x464cb6);}},{filter:filter='{}',sort:sort='{}',skip:skip=0x0,select:select='',limit:limit=0xa,startDate:_0x132b78,endDate:_0x454dec,selectedDateField:_0x4d7179}=_0x5233f2,_0x48a51c=JSON[_0x5053e9(0xd9)](filter),_0x538f23=JSON[_0x5053e9(0xd9)](sort);try{if(_0x132b78&&_0x454dec&&_0x4d7179){const _0x39104b=new Date(_0x132b78);_0x39104b['setHours'](0x0,0x0,0x0,0x0);const _0x41bf6c=new Date(_0x454dec);_0x41bf6c['setHours'](0x17,0x3b,0x3b,0x3e7),_0x48a51c[_0x4d7179]={'$gte':_0x39104b,'$lte':_0x41bf6c};}if(_0x48a51c[_0x5053e9(0xef)]){const _0x1ce321=_0x48a51c['customer'];delete _0x48a51c[_0x5053e9(0xef)],_0x48a51c[_0x33907e['IWoGZ']]=[{'customer.name':{'$regex':_0x1ce321['$regex'],'$options':'i'}},{'customer.phone_number':{'$regex':_0x1ce321[_0x5053e9(0xb0)],'$options':'i'}}];}const _0x10dc4d=await this['invoiceModel'][_0x5053e9(0xb4)]({..._0x48a51c,'location':_0x5052a9[_0x5053e9(0xc3)][_0x5053e9(0xdc)]})[_0x5053e9(0xc0)](_0x538f23)[_0x5053e9(0xd4)](Number(skip))['limit'](_0x33907e['lRibH'](Number,limit))['select'](select)['populate']('bank\x20customer')['exec']();return _0x10dc4d;}catch(_0x227d1a){(0x0,do_logger_1[_0x5053e9(0xb9)])(_0x5053e9(0xb2)+_0x227d1a[_0x5053e9(0xe4)],'ERROR');throw new Error(_0x5053e9(0xb2)+_0x227d1a[_0x5053e9(0xe4)]);}}[a50_0x1db781(0xeb)](_0x2c7a7e){const _0x589c1b=a50_0x1db781;try{return this[_0x589c1b(0xaf)]['findOne'](JSON[_0x589c1b(0xd9)](_0x2c7a7e));}catch(_0x52eeec){(0x0,do_logger_1[_0x589c1b(0xb9)])(_0x589c1b(0xde)+_0x52eeec['message'],_0x589c1b(0xbc));throw new Error(_0x589c1b(0xb2)+_0x52eeec['message']);}}async['update'](_0x11217a,_0x5150b7,_0x48a1d5){const _0x34e309=a50_0x1db781,_0x4ba73e=await this[_0x34e309(0xaf)][_0x34e309(0xeb)](JSON[_0x34e309(0xd9)](_0x11217a));if(!_0x4ba73e)throw new Error(_0x34e309(0xe9));Object['keys'](_0x5150b7)[_0x34e309(0xc9)](_0x2cf7bc=>{_0x4ba73e[_0x2cf7bc]=_0x5150b7[_0x2cf7bc];});try{return await this['logService'][_0x34e309(0xe7)](_0x48a1d5[_0x34e309(0xc3)][_0x34e309(0xea)],_0x48a1d5['user'][_0x34e309(0xe1)],_0x34e309(0xf1),_0x34e309(0xb8)+_0x11217a),_0x4ba73e['save']();}catch(_0x7adf8){(0x0,do_logger_1[_0x34e309(0xb9)])(_0x34e309(0xd0)+_0x7adf8,_0x34e309(0xbc));throw new Error(_0x34e309(0xbb)+_0x7adf8[_0x34e309(0xe4)]);}}async[a50_0x1db781(0xce)](_0x190542){const _0x5afaa3=a50_0x1db781,_0x2f1daf=await this['invoiceModel']['findById'](_0x190542)[_0x5afaa3(0xc2)]('customer');_0x2f1daf[_0x5afaa3(0xef)]['phone_number']=this['formatPhoneNumber'](_0x2f1daf[_0x5afaa3(0xef)]['phone_number']);}async[a50_0x1db781(0xd5)](_0x9d9fef,_0x50c1af){const _0x1ecb74=a50_0x1db781,_0x23e004={'JMuiq':_0x1ecb74(0xcb),'eJGet':'ERROR'};try{return await this['invoiceModel']['findOneAndDelete'](_0x9d9fef),await this[_0x1ecb74(0xe0)][_0x1ecb74(0xe7)](_0x50c1af[_0x1ecb74(0xc3)][_0x1ecb74(0xea)],_0x50c1af[_0x1ecb74(0xc3)]['username'],_0x23e004[_0x1ecb74(0xe5)],'Removed\x20Invoice\x20with\x20filter\x20'+JSON['stringify'](_0x9d9fef)),!![];}catch(_0x57aea1){(0x0,do_logger_1[_0x1ecb74(0xb9)])(_0x1ecb74(0xdb)+_0x57aea1,_0x23e004[_0x1ecb74(0xc5)]);throw new Error('Error\x20removing\x20invoices:\x20'+_0x57aea1[_0x1ecb74(0xe4)]);}}['formatPhoneNumber'](_0x52115e){const _0x16a164=a50_0x1db781,_0x5a6095=_0x52115e['replace'](/\D/g,'');if(_0x5a6095[_0x16a164(0xc8)]('0'))return _0x16a164(0xec)+_0x5a6095[_0x16a164(0xf5)](0x1)+'@c.us';else{if(_0x5a6095[_0x16a164(0xc8)](_0x16a164(0xec)))return _0x5a6095+_0x16a164(0xbd);else throw new Error('Invalid\x20Nigerian\x20phone\x20number');}}};exports['InvoiceService']=InvoiceService,exports['InvoiceService']=InvoiceService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,mongoose_1['InjectModel'])(invoice_schema_1['Invoice'][a50_0x1db781(0xb1)])),__metadata('design:paramtypes',[mongoose_2[a50_0x1db781(0xc7)],activity_service_1['ActivityService']])],InvoiceService);