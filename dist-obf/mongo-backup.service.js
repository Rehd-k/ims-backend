'use strict';const a56_0x37d685=a56_0x9d0c;(function(_0x42857d,_0x23a2a4){const _0x44e3ad=a56_0x9d0c,_0xb14523=_0x42857d();while(!![]){try{const _0x552128=parseInt(_0x44e3ad(0xaf))/0x1*(-parseInt(_0x44e3ad(0xd3))/0x2)+-parseInt(_0x44e3ad(0xb3))/0x3*(parseInt(_0x44e3ad(0xbe))/0x4)+-parseInt(_0x44e3ad(0xb7))/0x5*(parseInt(_0x44e3ad(0xbc))/0x6)+-parseInt(_0x44e3ad(0xb8))/0x7+-parseInt(_0x44e3ad(0xc8))/0x8*(-parseInt(_0x44e3ad(0xd4))/0x9)+parseInt(_0x44e3ad(0xc9))/0xa*(parseInt(_0x44e3ad(0xb5))/0xb)+-parseInt(_0x44e3ad(0xb0))/0xc*(-parseInt(_0x44e3ad(0xbf))/0xd);if(_0x552128===_0x23a2a4)break;else _0xb14523['push'](_0xb14523['shift']());}catch(_0xdab4bb){_0xb14523['push'](_0xb14523['shift']());}}}(a56_0x3acf,0x4a769));function a56_0x3acf(){const _0x1d9eb5=['392353finBMz','length','replace','toISOString','scheduleBackup','archiver','node-cron','fs-extra','remove','2201432OVucsT','3731390rrhdfy','join','connect','zip','writeJson','decorate','mongodb://127.0.0.1:27017/ims','object','.json','catch','2MXoLgQ','18vXIuLJ','zipFolder','performBackup','mongoUri','382553ksgYoR','492AMoBux','defineProperty','Injectable','12WkzsVW','LlwDn','11DZphsR','MongoBackupService','5HFJPaH','2747164ckDaOV','finalize','ensureDir','error','3056160RRZdZY','function','571552xLLmXd'];a56_0x3acf=function(){return _0x1d9eb5;};return a56_0x3acf();}function a56_0x9d0c(_0x268eb4,_0x87e23c){const _0x3acf85=a56_0x3acf();return a56_0x9d0c=function(_0x9d0c32,_0x3086ad){_0x9d0c32=_0x9d0c32-0xac;let _0x40607c=_0x3acf85[_0x9d0c32];return _0x40607c;},a56_0x9d0c(_0x268eb4,_0x87e23c);}var __decorate=this&&this['__decorate']||function(_0x575cd5,_0x184bcb,_0x12ba46,_0x5d08c9){const _0x1568f7=a56_0x9d0c,_0x4c24e4={'LlwDn':function(_0x560d04,_0x255d8c){return _0x560d04<_0x255d8c;},'OSGCZ':function(_0x3701d0,_0x2dbb10){return _0x3701d0===_0x2dbb10;}};var _0x500e7d=arguments[_0x1568f7(0xc0)],_0x5c1522=_0x4c24e4[_0x1568f7(0xb4)](_0x500e7d,0x3)?_0x184bcb:_0x5d08c9===null?_0x5d08c9=Object['getOwnPropertyDescriptor'](_0x184bcb,_0x12ba46):_0x5d08c9,_0x57f3f0;if(typeof Reflect===_0x1568f7(0xd0)&&_0x4c24e4['OSGCZ'](typeof Reflect[_0x1568f7(0xce)],_0x1568f7(0xbd)))_0x5c1522=Reflect[_0x1568f7(0xce)](_0x575cd5,_0x184bcb,_0x12ba46,_0x5d08c9);else{for(var _0x16426d=_0x575cd5[_0x1568f7(0xc0)]-0x1;_0x16426d>=0x0;_0x16426d--)if(_0x57f3f0=_0x575cd5[_0x16426d])_0x5c1522=(_0x500e7d<0x3?_0x57f3f0(_0x5c1522):_0x500e7d>0x3?_0x57f3f0(_0x184bcb,_0x12ba46,_0x5c1522):_0x57f3f0(_0x184bcb,_0x12ba46))||_0x5c1522;}return _0x500e7d>0x3&&_0x5c1522&&Object[_0x1568f7(0xb1)](_0x184bcb,_0x12ba46,_0x5c1522),_0x5c1522;};Object[a56_0x37d685(0xb1)](exports,'__esModule',{'value':!![]}),exports['MongoBackupService']=void 0x0;const common_1=require('@nestjs/common'),mongoose=require('mongoose'),fs=require(a56_0x37d685(0xc6)),path=require('path'),archiver=require(a56_0x37d685(0xc4)),cron=require(a56_0x37d685(0xc5));let MongoBackupService=class MongoBackupService{constructor(){const _0x1eec1c=a56_0x37d685;this[_0x1eec1c(0xae)]=_0x1eec1c(0xcf);}async['onModuleInit'](){const _0x44f307=a56_0x37d685;await mongoose[_0x44f307(0xcb)](this['mongoUri']),this[_0x44f307(0xc3)]();}[a56_0x37d685(0xc3)](){const _0x54b6b6=a56_0x37d685;cron['schedule']('0\x20*/4\x20*\x20*\x20*',()=>{const _0x4585c7=a56_0x9d0c;this['performBackup']()[_0x4585c7(0xd2)](console['error']);}),this[_0x54b6b6(0xad)]()['catch'](console[_0x54b6b6(0xbb)]);}async[a56_0x37d685(0xad)](){const _0x53afd7=a56_0x37d685,_0x2d6645=new Date()[_0x53afd7(0xc2)]()[_0x53afd7(0xc1)](/[:.]/g,'-'),_0x3ddad4='backup_'+_0x2d6645,_0x26aad0=path[_0x53afd7(0xca)]('./backups'),_0x23dc04=path['join'](_0x26aad0,_0x3ddad4),_0x14520e=path[_0x53afd7(0xca)](_0x26aad0,_0x3ddad4+'.zip');await fs[_0x53afd7(0xc7)](_0x26aad0),await fs[_0x53afd7(0xba)](_0x23dc04);const _0x6bc5ca=await mongoose['connection']['db']['listCollections']()['toArray']();for(const {name:_0x3c2daf}of _0x6bc5ca){const _0xa628b4=await mongoose['connection']['db']['collection'](_0x3c2daf)['find']({})['toArray']();await fs[_0x53afd7(0xcd)](path['join'](_0x23dc04,_0x3c2daf+_0x53afd7(0xd1)),_0xa628b4,{'spaces':0x2});}await this[_0x53afd7(0xac)](_0x23dc04,_0x14520e),await fs['remove'](_0x23dc04);}async[a56_0x37d685(0xac)](_0x448747,_0x2656f7){return new Promise((_0x5d64ab,_0x52d8d5)=>{const _0x57d71d=a56_0x9d0c,_0x53f510=fs['createWriteStream'](_0x2656f7),_0x16d90f=archiver(_0x57d71d(0xcc),{'zlib':{'level':0x9}});_0x53f510['on']('close',_0x5d64ab),_0x16d90f['on']('error',_0x52d8d5),_0x16d90f['pipe'](_0x53f510),_0x16d90f['directory'](_0x448747,![]),_0x16d90f[_0x57d71d(0xb9)]();});}};exports[a56_0x37d685(0xb6)]=MongoBackupService,exports[a56_0x37d685(0xb6)]=MongoBackupService=__decorate([(0x0,common_1[a56_0x37d685(0xb2)])()],MongoBackupService);