'use strict';const a73_0xbe8f6c=a73_0x3d2e;function a73_0x3d2e(_0x58706c,_0xacffec){const _0x29792c=a73_0x2979();return a73_0x3d2e=function(_0x3d2e7e,_0x68cf6f){_0x3d2e7e=_0x3d2e7e-0x19e;let _0x34b28f=_0x29792c[_0x3d2e7e];return _0x34b28f;},a73_0x3d2e(_0x58706c,_0xacffec);}function a73_0x2979(){const _0x1fc7d1=['role','$totalAmount','findById','setHours','Last\x20Month','Error\x20finding\x20one\x20','update','Second\x20Quarter','getMonth','length','findOne','forEach','replace','decorate','logAction','$products.total','total','Invalid\x20option','../product/inventory.service','Inject','Last\x20Week','hasOwnProperty','addOrder','Last\x207\x20Days','Injectable','Error\x20deleting\x20one\x20','PurchasesService','from','ERROR','cashier','This\x20Year','purchaseService','exec','InjectModel','$transfer','Error\x20gettig\x20single\x20sale\x20data\x20','push','5eUCSnI','$products','products','returns','toString','splice','Transaction\x20Id\x20','total_profit','1269024hgvRdI','@nestjs/mongoose','userId','parse','doSell','populate','Made\x20Returns','quantity','saleModel','setDate','CustomerService','949365dKPWsi','deductStock','username','totalAmount','return','SalesService','findAll','\x20with\x20','formatPhoneNumber','$_id.for','$transactionDate','getDay','getSingleProductSaleData','log','batches','Logger','staff','Error\x20updaing\x20one\x20','object','../purchases/purchases.service','aggregate','customerService','metadata','Updated\x20sale\x20with\x20transaction\x20Id\x20','522760rXMjKb','Deleted\x20Transaction','logger','reduce','customer\x20bank','Error\x20returnig\x20one\x20','barcodeId','productId','defineProperty','getOwnPropertyDescriptor','delete','$card','price','profit','getSalesData','Invalid\x20Nigerian\x20phone\x20number','orderBatch','startDate','handler','customer','find','getDate','countDocuments','3057929xhDzlI','First\x20Quarter','transactionDate','../customer/customer.service','sort','inventoryService','activityService','BadRequestException','skip','_id','$createdAt','$products.price','188159EmUWDj','Today','select','mongoose','__esModule','location','breakdown','restockProduct','transactionId','../do_logger','getFullYear','startsWith','__metadata','$products.quantity','$discount','cash','1092732iQSUXf','@nestjs/common','sold','This\x20Month','function','../activity/activity.service','__param','Sale','substring','sorter','Update\x20Sales','stringify','findIndex','./sales.schema','This\x20Week','6Uxwuaw','doSearch','InternalServerErrorException','@c.us','create','34002dauGMc','save','InventoryService','9DFSbkX','user','__decorate','card','Made\x20returns\x20on\x20transaction\x20with\x20Id\x20'];a73_0x2979=function(){return _0x1fc7d1;};return a73_0x2979();}(function(_0x1ee628,_0x16a0f4){const _0x4dda5d=a73_0x3d2e,_0x4e46d3=_0x1ee628();while(!![]){try{const _0x368af0=parseInt(_0x4dda5d(0x233))/0x1+parseInt(_0x4dda5d(0x1b8))/0x2*(-parseInt(_0x4dda5d(0x1bb))/0x3)+-parseInt(_0x4dda5d(0x1a4))/0x4*(-parseInt(_0x4dda5d(0x1e5))/0x5)+parseInt(_0x4dda5d(0x1b3))/0x6*(-parseInt(_0x4dda5d(0x227))/0x7)+parseInt(_0x4dda5d(0x1ed))/0x8+parseInt(_0x4dda5d(0x1f8))/0x9+parseInt(_0x4dda5d(0x210))/0xa;if(_0x368af0===_0x16a0f4)break;else _0x4e46d3['push'](_0x4e46d3['shift']());}catch(_0x5f0e16){_0x4e46d3['push'](_0x4e46d3['shift']());}}}(a73_0x2979,0x46c59));var __decorate=this&&this[a73_0xbe8f6c(0x1bd)]||function(_0x18f9ea,_0x410846,_0x4dcc48,_0x2dd292){const _0x372e0b=a73_0xbe8f6c;var _0x152be7=arguments[_0x372e0b(0x1c9)],_0x251af6=_0x152be7<0x3?_0x410846:_0x2dd292===null?_0x2dd292=Object[_0x372e0b(0x219)](_0x410846,_0x4dcc48):_0x2dd292,_0x48bc27;if(typeof Reflect==='object'&&typeof Reflect[_0x372e0b(0x1cd)]===_0x372e0b(0x1a8))_0x251af6=Reflect[_0x372e0b(0x1cd)](_0x18f9ea,_0x410846,_0x4dcc48,_0x2dd292);else{for(var _0x5318=_0x18f9ea[_0x372e0b(0x1c9)]-0x1;_0x5318>=0x0;_0x5318--)if(_0x48bc27=_0x18f9ea[_0x5318])_0x251af6=(_0x152be7<0x3?_0x48bc27(_0x251af6):_0x152be7>0x3?_0x48bc27(_0x410846,_0x4dcc48,_0x251af6):_0x48bc27(_0x410846,_0x4dcc48))||_0x251af6;}return _0x152be7>0x3&&_0x251af6&&Object[_0x372e0b(0x218)](_0x410846,_0x4dcc48,_0x251af6),_0x251af6;},__metadata=this&&this[a73_0xbe8f6c(0x1a0)]||function(_0x196ca6,_0x1b4b5c){const _0x4d731c=a73_0xbe8f6c;if(typeof Reflect===_0x4d731c(0x20a)&&typeof Reflect[_0x4d731c(0x20e)]==='function')return Reflect[_0x4d731c(0x20e)](_0x196ca6,_0x1b4b5c);},__param=this&&this[a73_0xbe8f6c(0x1aa)]||function(_0x533b10,_0x5b3469){return function(_0x20d5a8,_0xbe754b){_0x5b3469(_0x20d5a8,_0xbe754b,_0x533b10);};};Object[a73_0xbe8f6c(0x218)](exports,a73_0xbe8f6c(0x237),{'value':!![]}),exports[a73_0xbe8f6c(0x1fd)]=void 0x0;const common_1=require(a73_0xbe8f6c(0x1a5)),mongoose_1=require(a73_0xbe8f6c(0x1ee)),mongoose_2=require(a73_0xbe8f6c(0x236)),inventory_service_1=require(a73_0xbe8f6c(0x1d2)),sales_schema_1=require(a73_0xbe8f6c(0x1b1)),purchases_service_1=require(a73_0xbe8f6c(0x20b)),customer_service_1=require(a73_0xbe8f6c(0x22a)),activity_service_1=require(a73_0xbe8f6c(0x1a9)),do_logger_1=require(a73_0xbe8f6c(0x23c));let SalesService=class SalesService{constructor(_0x6cc2a1,_0x39232a,_0x26a414,_0xfb3860,_0x2c56e6){const _0x4fe4db=a73_0xbe8f6c;this['inventoryService']=_0x6cc2a1,this['saleModel']=_0x39232a,this[_0x4fe4db(0x22d)]=_0x26a414,this['customerService']=_0xfb3860,this[_0x4fe4db(0x1df)]=_0x2c56e6,this[_0x4fe4db(0x212)]=common_1[_0x4fe4db(0x207)];}async[a73_0xbe8f6c(0x1f1)](_0x51e666,_0xc45771){const _0x46f61f=a73_0xbe8f6c;let _0x2a96f3=0x0,_0x5ba5be=0x0;try{for(const _0x34a695 of _0x51e666[_0x46f61f(0x1e7)]){_0x2a96f3=_0x34a695[_0x46f61f(0x1f4)],_0x34a695[_0x46f61f(0x239)]=[];try{while(_0x2a96f3>0x0){await _0x4b03b1(_0x34a695,this[_0x46f61f(0x1df)]);}for(const _0x2a6adf of _0x34a695[_0x46f61f(0x239)]){_0x5ba5be=_0x5ba5be+_0x2a6adf[_0x46f61f(0x1ec)];}}catch(_0x29926c){(0x0,do_logger_1[_0x46f61f(0x205)])('Error\x20crating\x20sell\x20brakedown\x20'+_0x29926c,'ERROR');throw new common_1[(_0x46f61f(0x22e))](_0x29926c);}}_0x51e666[_0x46f61f(0x21d)]=_0x5ba5be,_0x51e666['handler']=_0xc45771[_0x46f61f(0x1bc)][_0x46f61f(0x1fa)],_0x51e666[_0x46f61f(0x1fb)]=_0x51e666[_0x46f61f(0x1a3)]+_0x51e666[_0x46f61f(0x1be)]+_0x51e666['transfer'],_0x51e666[_0x46f61f(0x238)]=_0xc45771['user'][_0x46f61f(0x238)];const _0x4507fd=await this['saleModel'][_0x46f61f(0x1b7)](_0x51e666);for(const _0x2e763b of _0x4507fd['products']){await this['inventoryService'][_0x46f61f(0x1f9)](_0x2e763b[_0x46f61f(0x230)],_0x2e763b[_0x46f61f(0x1f4)],_0xc45771),await this[_0x46f61f(0x22c)]['addToSold'](_0x2e763b[_0x46f61f(0x230)],_0x2e763b[_0x46f61f(0x1f4)]);}return _0x51e666['customer']&&_0x51e666[_0x46f61f(0x223)]!==''&&await this[_0x46f61f(0x20d)][_0x46f61f(0x1d6)](_0x51e666[_0x46f61f(0x223)],_0x4507fd[_0x46f61f(0x230)],_0x4507fd[_0x46f61f(0x1fb)]),await this[_0x46f61f(0x22d)]['logAction'](''+_0xc45771[_0x46f61f(0x1bc)][_0x46f61f(0x1ef)],_0xc45771[_0x46f61f(0x1bc)][_0x46f61f(0x1fa)],'Made\x20Sales',_0x46f61f(0x1eb)+_0x4507fd['transactionId']),_0x4507fd[_0x46f61f(0x1f2)]('customer\x20bank');}catch(_0x32c577){(0x0,do_logger_1[_0x46f61f(0x205)])(_0x32c577,_0x46f61f(0x1dc));throw new common_1['InternalServerErrorException'](_0x32c577);}async function _0x4b03b1(_0x4e9fa4,_0x4b1dc2){const _0x348808=_0x46f61f,_0x3b3491=await _0x4b1dc2['findFirstUnsoldPurchase'](_0x4e9fa4[_0x348808(0x230)],_0xc45771),_0xfd84d3=_0x3b3491[_0x348808(0x1a6)][_0x348808(0x213)]((_0x10af05,_0x2f2e2d)=>_0x10af05+(_0x2f2e2d['amount']||0x0),0x0),_0x482e32=_0x3b3491[_0x348808(0x1f4)]-_0xfd84d3;if(_0x482e32>=_0x2a96f3){const _0x1d938a={'orderBatch':_0x3b3491['_id'],'quantity':_0x2a96f3,'costPrice':_0x3b3491[_0x348808(0x21c)],'profit':_0x4e9fa4[_0x348808(0x21c)]-_0x3b3491[_0x348808(0x21c)],'total_profit':(_0x4e9fa4[_0x348808(0x21c)]-_0x3b3491[_0x348808(0x21c)])*_0x2a96f3};_0x4e9fa4[_0x348808(0x239)][_0x348808(0x1e4)](_0x1d938a),_0x3b3491[_0x348808(0x1a6)][_0x348808(0x1e4)]({'amount':_0x2a96f3,'price':_0x4e9fa4[_0x348808(0x21c)]}),_0x2a96f3=0x0,await _0x3b3491[_0x348808(0x1b9)]();}else{const _0x3e2b2f={'orderBatch':_0x3b3491['_id'],'quantity':_0x482e32,'costPrice':_0x3b3491[_0x348808(0x21c)],'profit':_0x4e9fa4['price']-_0x3b3491[_0x348808(0x21c)],'total_profit':(_0x4e9fa4['price']-_0x3b3491[_0x348808(0x21c)])*_0x482e32};_0x4e9fa4[_0x348808(0x239)]=_0x4e9fa4[_0x348808(0x239)][_0x348808(0x1e4)](_0x3e2b2f),_0x3b3491[_0x348808(0x1a6)]['push']({'amount':_0x482e32,'price':_0x4e9fa4['price']}),_0x2a96f3=_0x2a96f3-_0x482e32,await _0x3b3491[_0x348808(0x1b9)]();}}}async[a73_0xbe8f6c(0x204)](_0x57a463,_0x4d69a1,_0x447327){const _0x1ca465=a73_0xbe8f6c,{filter:filter='{}'}=_0x4d69a1,_0x475b7c=JSON[_0x1ca465(0x1f0)](filter),_0x364346=new Date();let _0x5870ae,_0x3938e2,_0x51fd0a;switch(_0x475b7c[_0x1ca465(0x1ad)]){case _0x1ca465(0x234):_0x5870ae=new Date(_0x364346[_0x1ca465(0x1c3)](0x0,0x0,0x0,0x0)),_0x3938e2=new Date(_0x364346[_0x1ca465(0x1c3)](0x17,0x3b,0x3b,0x3e7)),_0x51fd0a={'for':{'$add':[{'$divide':[{'$subtract':[{'$hour':'$transactionDate'},{'$mod':[{'$hour':_0x1ca465(0x202)},0x2]}]},0x2]},0x1]}};break;case _0x1ca465(0x1b2):_0x5870ae=new Date(_0x364346[_0x1ca465(0x1f6)](_0x364346[_0x1ca465(0x225)]()-_0x364346['getDay']())),_0x3938e2=new Date(_0x364346[_0x1ca465(0x1f6)](_0x364346[_0x1ca465(0x225)]()-_0x364346[_0x1ca465(0x203)]()+0x6)),_0x51fd0a={'for':{'$dayOfWeek':'$transactionDate'}};break;case _0x1ca465(0x1d7):_0x5870ae=new Date(),_0x5870ae[_0x1ca465(0x1f6)](_0x5870ae[_0x1ca465(0x225)]()-0x6),_0x5870ae[_0x1ca465(0x1c3)](0x0,0x0,0x0,0x0),_0x3938e2=new Date(),_0x3938e2[_0x1ca465(0x1c3)](0x17,0x3b,0x3b,0x3e7),_0x51fd0a={'for':{'$subtract':[{'$add':[{'$dateDiff':{'startDate':_0x5870ae,'endDate':'$transactionDate','unit':'day'}},0x1]},0x1]}};break;case _0x1ca465(0x1d4):_0x5870ae=new Date(_0x364346[_0x1ca465(0x1f6)](_0x364346[_0x1ca465(0x225)]()-_0x364346[_0x1ca465(0x203)]()-0x7)),_0x3938e2=new Date(_0x364346[_0x1ca465(0x1f6)](_0x364346[_0x1ca465(0x225)]()-_0x364346[_0x1ca465(0x203)]()-0x1)),_0x51fd0a={'for':{'$dayOfWeek':_0x1ca465(0x202)}};break;case _0x1ca465(0x1a7):_0x5870ae=new Date(_0x364346[_0x1ca465(0x19e)](),_0x364346[_0x1ca465(0x1c8)](),0x1),_0x3938e2=new Date(_0x364346[_0x1ca465(0x19e)](),_0x364346[_0x1ca465(0x1c8)]()+0x1,0x0),_0x51fd0a={'for':{'$dayOfMonth':'$transactionDate'}};break;case _0x1ca465(0x1c4):_0x5870ae=new Date(_0x364346[_0x1ca465(0x19e)](),_0x364346[_0x1ca465(0x1c8)]()-0x1,0x1),_0x3938e2=new Date(_0x364346[_0x1ca465(0x19e)](),_0x364346[_0x1ca465(0x1c8)](),0x0),_0x51fd0a={'for':{'$dayOfMonth':_0x1ca465(0x202)}};break;case _0x1ca465(0x228):_0x5870ae=new Date(_0x364346['getFullYear'](),0x0,0x1),_0x3938e2=new Date(_0x364346['getFullYear'](),0x3,0x0),_0x51fd0a={'for':{'$month':_0x1ca465(0x202)}};break;case _0x1ca465(0x1c7):_0x5870ae=new Date(_0x364346['getFullYear'](),0x3,0x1),_0x3938e2=new Date(_0x364346[_0x1ca465(0x19e)](),0x6,0x0),_0x51fd0a={'for':{'$month':_0x1ca465(0x202)}};break;case'Third\x20Quarter':_0x5870ae=new Date(_0x364346[_0x1ca465(0x19e)](),0x6,0x1),_0x3938e2=new Date(_0x364346[_0x1ca465(0x19e)](),0x9,0x0),_0x51fd0a={'for':{'$month':_0x1ca465(0x202)}};break;case'Fourth\x20Quarter':_0x5870ae=new Date(_0x364346[_0x1ca465(0x19e)](),0x9,0x1),_0x3938e2=new Date(_0x364346[_0x1ca465(0x19e)](),0xc,0x0),_0x51fd0a={'for':{'$month':_0x1ca465(0x202)}};break;case _0x1ca465(0x1de):_0x5870ae=new Date(_0x364346[_0x1ca465(0x19e)](),0x0,0x1),_0x3938e2=new Date(_0x364346['getFullYear'](),0xb,0x1f),_0x51fd0a={'for':{'$month':_0x1ca465(0x202)}};break;default:throw new Error(_0x1ca465(0x1d1));}try{const _0x5ee021=await this[_0x1ca465(0x1f5)][_0x1ca465(0x20c)]([{'$match':{'products._id':_0x57a463,'transactionDate':{'$gte':_0x5870ae,'$lte':_0x3938e2},'location':_0x447327[_0x1ca465(0x1bc)][_0x1ca465(0x238)]}},{'$unwind':'$products'},{'$group':{'_id':_0x51fd0a,'totalSales':{'$sum':_0x1ca465(0x1cf)}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x0,'for':_0x1ca465(0x201),'totalSales':0x1}}]);return _0x5ee021;}catch(_0x5639c7){(0x0,do_logger_1[_0x1ca465(0x205)])(_0x1ca465(0x1e3)+_0x5639c7,_0x1ca465(0x1dc));throw new common_1['BadRequestException'](_0x5639c7);}}async[a73_0xbe8f6c(0x1b4)](_0x180a65,_0x1ddad6){const _0x48075c=a73_0xbe8f6c,_0x58f097={},_0x1275c6={'$text':{'$search':_0x180a65}};try{return await this[_0x48075c(0x1f5)][_0x48075c(0x224)]({..._0x1275c6,'location':_0x1ddad6[_0x48075c(0x1bc)][_0x48075c(0x238)]})[_0x48075c(0x1e0)]();}catch(_0x2000ca){(0x0,do_logger_1['log'])('Error\x20searching\x20'+_0x2000ca,_0x48075c(0x1dc));throw new common_1['BadRequestException'](_0x2000ca);}}async[a73_0xbe8f6c(0x1fe)](_0x2713a9,_0x542694){const _0x4e4549=a73_0xbe8f6c,{filter:filter='{}',sort:sort='{}',skip:skip=0x0,select:select='',limit:limit=0xa}=_0x2713a9,_0x4f9659=JSON[_0x4e4549(0x1f0)](filter),_0x559cf3=JSON[_0x4e4549(0x1f0)](sort);try{const _0x55f805=new Date(_0x2713a9[_0x4e4549(0x221)]);_0x55f805[_0x4e4549(0x1c3)](0x0,0x0,0x0,0x0);const _0x2f6941=new Date(_0x2713a9['endDate']);_0x2f6941['setHours'](0x17,0x3b,0x3b,0x3e7),_0x4f9659[_0x4e4549(0x229)]={'$gte':_0x55f805,'$lte':_0x2f6941};_0x542694['user'][_0x4e4549(0x1c0)]===_0x4e4549(0x1dd)&&(_0x4f9659['handler']=_0x542694['user'][_0x4e4549(0x1fa)]);_0x542694[_0x4e4549(0x1bc)][_0x4e4549(0x1c0)]===_0x4e4549(0x208)&&(_0x4f9659['handler']=_0x542694['user'][_0x4e4549(0x1fa)]);_0x4f9659&&typeof _0x4f9659===_0x4e4549(0x20a)&&_0x4e4549(0x216)in _0x4f9659&&(_0x2713a9[_0x4e4549(0x22f)]=0x0,delete _0x4f9659[_0x4e4549(0x229)]);const _0x58768c=await this['saleModel'][_0x4e4549(0x20c)]([{'$match':{..._0x4f9659,'location':_0x542694[_0x4e4549(0x1bc)][_0x4e4549(0x238)]}},{'$group':{'_id':null,'totalAmount':{'$sum':_0x4e4549(0x1c1)},'totalDiscount':{'$sum':_0x4e4549(0x1a2)},'totalTransfer':{'$sum':_0x4e4549(0x1e2)},'totalCard':{'$sum':_0x4e4549(0x21b)},'totalCash':{'$sum':'$cash'},'totalProfit':{'$sum':'$profit'}}}]),_0x54441e=_0x58768c['length']>0x0?_0x58768c[0x0]:{'totalAmount':0x0,'totalDiscount':0x0,'totalTransfer':0x0,'totalCard':0x0,'totalCash':0x0,'totalProfit':0x0},_0xd69a03=await this[_0x4e4549(0x1f5)][_0x4e4549(0x224)]({..._0x4f9659,'location':_0x542694[_0x4e4549(0x1bc)][_0x4e4549(0x238)]})[_0x4e4549(0x22b)](_0x559cf3)[_0x4e4549(0x22f)](Number(skip))['limit'](Number(limit))[_0x4e4549(0x235)](select)['populate'](_0x4e4549(0x214))[_0x4e4549(0x1e0)](),_0xc0e11f=new Set();_0xd69a03[_0x4e4549(0x1cb)](_0x43f897=>_0xc0e11f['add'](_0x43f897['handler']));const _0x5e526c=Array[_0x4e4549(0x1db)](_0xc0e11f),_0x52c51b=await this[_0x4e4549(0x1f5)][_0x4e4549(0x226)]({..._0x4f9659,'location':_0x542694['user'][_0x4e4549(0x238)]});return{'sales':_0xd69a03,'handlers':_0x5e526c,'totalDocuments':_0x52c51b,'summary':_0x54441e};}catch(_0x3ed227){(0x0,do_logger_1[_0x4e4549(0x205)])(_0x3ed227,_0x4e4549(0x1dc));throw new common_1[(_0x4e4549(0x1b5))](_0x3ed227);}}async[a73_0xbe8f6c(0x1ca)](_0x451d6d){const _0x5b9578=a73_0xbe8f6c;try{return await this[_0x5b9578(0x1f5)][_0x5b9578(0x1c2)](_0x451d6d)[_0x5b9578(0x1f2)]('customer\x20bank')[_0x5b9578(0x1e0)]();}catch(_0x3c9220){(0x0,do_logger_1['log'])(_0x5b9578(0x1c5)+_0x3c9220,'ERROR');throw new common_1[(_0x5b9578(0x22e))](_0x3c9220);}}async[a73_0xbe8f6c(0x1c6)](_0x236dff,_0x5f3525,_0x50a1da){const _0x3268fd=a73_0xbe8f6c;try{const _0x4298f5=await this[_0x3268fd(0x1f5)][_0x3268fd(0x1c2)](_0x236dff);for(const _0x3b9a17 in _0x5f3525){_0x5f3525[_0x3268fd(0x1d5)](_0x3b9a17)&&_0x4298f5[_0x3b9a17]!==undefined&&(_0x4298f5[_0x3b9a17]=_0x5f3525[_0x3b9a17]);}const _0x3a9e9f=await _0x4298f5[_0x3268fd(0x1b9)]();return await this[_0x3268fd(0x22d)][_0x3268fd(0x1ce)](''+_0x50a1da[_0x3268fd(0x1bc)]['userId'],_0x50a1da['user']['username'],_0x3268fd(0x1ae),_0x3268fd(0x20f)+_0x3a9e9f[_0x3268fd(0x23b)]+_0x3268fd(0x1ff)+JSON[_0x3268fd(0x1af)](_0x5f3525)),_0x3a9e9f;}catch(_0x1f331d){(0x0,do_logger_1['log'])(_0x3268fd(0x209)+_0x1f331d,'ERROR');throw new common_1[(_0x3268fd(0x22e))](_0x1f331d);}}async[a73_0xbe8f6c(0x1fc)](_0x2cd1b3,_0x289b39,_0x56a62e){const _0x1b7a5a=a73_0xbe8f6c;try{if(!_0x289b39[_0x1b7a5a(0x222)])for(const _0x2cff74 of _0x289b39[_0x1b7a5a(0x1e8)]){_0x2cff74[_0x1b7a5a(0x222)]=_0x56a62e[_0x1b7a5a(0x1bc)][_0x1b7a5a(0x1fa)];}else for(const _0x24e875 of _0x289b39[_0x1b7a5a(0x1e8)]){_0x24e875[_0x1b7a5a(0x222)]=_0x289b39['handler'];}const _0x4716a4=await this[_0x1b7a5a(0x1f5)]['findOne']({'_id':_0x2cd1b3});_0x4716a4['returns']=_0x4716a4[_0x1b7a5a(0x1e8)]['concat'](_0x289b39[_0x1b7a5a(0x1e8)]);let _0x502d3b=_0x289b39['returns'],_0x36a6fc=_0x4716a4[_0x1b7a5a(0x1e7)];for(const _0x720f2f of _0x502d3b){const _0x1cb583=_0x36a6fc[_0x1b7a5a(0x1b0)](_0x4b378e=>_0x4b378e[_0x1b7a5a(0x230)][_0x1b7a5a(0x1e9)]()===_0x720f2f[_0x1b7a5a(0x217)][_0x1b7a5a(0x1e9)]());if(_0x1cb583!==-0x1){let _0x52510c=_0x720f2f[_0x1b7a5a(0x1f4)];while(_0x52510c>0x0){let _0x298722=_0x720f2f[_0x1b7a5a(0x206)][0x0];_0x298722['quantity']<=_0x52510c?(await this[_0x1b7a5a(0x1df)]['editSoldQuantity'](_0x298722[_0x1b7a5a(0x220)],_0x298722[_0x1b7a5a(0x1f4)],_0x36a6fc[_0x1cb583][_0x1b7a5a(0x21c)]),_0x720f2f['batches'][_0x1b7a5a(0x1ea)](0x0,0x1),_0x52510c-=_0x298722[_0x1b7a5a(0x1f4)]):(await this[_0x1b7a5a(0x1df)]['editSoldQuantity'](_0x298722[_0x1b7a5a(0x220)],_0x52510c,_0x36a6fc[_0x1cb583]['price']),_0x720f2f[_0x1b7a5a(0x206)][0x0]['quantity']-=_0x52510c,_0x720f2f[_0x1b7a5a(0x206)][0x0][_0x1b7a5a(0x1ec)]=_0x720f2f['batches'][0x0][_0x1b7a5a(0x1f4)]*_0x720f2f[_0x1b7a5a(0x206)][0x0][_0x1b7a5a(0x21d)],_0x52510c=0x0);}_0x36a6fc[_0x1cb583][_0x1b7a5a(0x239)]=_0x720f2f[_0x1b7a5a(0x206)],_0x36a6fc[_0x1cb583][_0x1b7a5a(0x1f4)]-=_0x720f2f[_0x1b7a5a(0x1f4)],_0x36a6fc[_0x1cb583][_0x1b7a5a(0x1d0)]=_0x36a6fc[_0x1cb583][_0x1b7a5a(0x1f4)]*_0x36a6fc[_0x1cb583][_0x1b7a5a(0x21c)],_0x36a6fc[_0x1cb583][_0x1b7a5a(0x1f4)]<0x1&&_0x36a6fc[_0x1b7a5a(0x1ea)](_0x1cb583,0x1);}}_0x4716a4['totalAmount']=_0x36a6fc[_0x1b7a5a(0x213)]((_0x4f3273,_0x24c78c)=>_0x4f3273+_0x24c78c[_0x1b7a5a(0x1d0)],0x0);let _0x27c0a9=0x0;for(const _0x48e4d8 of _0x4716a4[_0x1b7a5a(0x1e7)]){for(const _0x46abef of _0x48e4d8[_0x1b7a5a(0x239)]){_0x27c0a9=_0x27c0a9+_0x46abef[_0x1b7a5a(0x1ec)];}}_0x4716a4[_0x1b7a5a(0x21d)]=_0x27c0a9,await _0x4716a4[_0x1b7a5a(0x1b9)]();for(const _0x49de4a of _0x289b39[_0x1b7a5a(0x1e8)]){await this[_0x1b7a5a(0x22c)][_0x1b7a5a(0x23a)](_0x49de4a['productId'],_0x49de4a[_0x1b7a5a(0x1f4)]),await this['inventoryService']['deductFromSold'](_0x49de4a[_0x1b7a5a(0x230)],_0x49de4a[_0x1b7a5a(0x1f4)]);}return await this[_0x1b7a5a(0x22d)][_0x1b7a5a(0x1ce)](''+_0x56a62e[_0x1b7a5a(0x1bc)][_0x1b7a5a(0x1ef)],_0x56a62e['user']['username'],_0x1b7a5a(0x1f3),'Made\x20returns\x20on\x20transaction\x20with\x20Id\x20'+_0x289b39['transactionId']),_0x4716a4;}catch(_0x5a8d73){(0x0,do_logger_1[_0x1b7a5a(0x205)])(_0x1b7a5a(0x215)+_0x5a8d73,_0x1b7a5a(0x1dc));throw new common_1[(_0x1b7a5a(0x22e))](_0x5a8d73);}}async[a73_0xbe8f6c(0x21a)](_0x58f932,_0x46c525){const _0x5b3481=a73_0xbe8f6c;try{const _0x560d22=await this[_0x5b3481(0x1f5)]['findByIdAndDelete'](_0x58f932)[_0x5b3481(0x1e0)]();return await this[_0x5b3481(0x22d)]['logAction'](''+_0x46c525[_0x5b3481(0x1bc)]['userId'],_0x46c525[_0x5b3481(0x1bc)][_0x5b3481(0x1fa)],_0x5b3481(0x211),_0x5b3481(0x1bf)+_0x58f932),_0x560d22;}catch(_0x415dd3){(0x0,do_logger_1['log'])(_0x5b3481(0x1d9)+_0x415dd3,_0x5b3481(0x1dc));throw new common_1[(_0x5b3481(0x22e))](_0x415dd3);}}async['getDashboardData'](_0x4446ca,_0x2e694d,_0x502180,_0x49bb3e){const _0x2bcf5e=a73_0xbe8f6c;!_0x2e694d&&(_0x2e694d=new Date(),_0x2e694d[_0x2bcf5e(0x1c3)](0x0,0x0,0x0,0x0));!_0x502180&&(_0x502180=new Date(),_0x502180[_0x2bcf5e(0x1c3)](0x17,0x3b,0x3b,0x3e7));const _0x3b1124=await this[_0x2bcf5e(0x1f5)][_0x2bcf5e(0x20c)]([{'$unwind':_0x2bcf5e(0x1e6)},{'$match':{'products._id':_0x4446ca,'createdAt':{'$gte':new Date(_0x2e694d),'$lte':new Date(_0x502180)},'location':_0x49bb3e[_0x2bcf5e(0x1bc)][_0x2bcf5e(0x238)]}},{'$group':{'_id':null,'totalAmount':{'$sum':_0x2bcf5e(0x1a1)},'totalPrice':{'$sum':{'$multiply':[_0x2bcf5e(0x232),_0x2bcf5e(0x1a1)]}},'sales_by_date':{'$push':{'date':_0x2bcf5e(0x231),'amount':'$products.quantity'}}}}]);return _0x3b1124;}async[a73_0xbe8f6c(0x21e)](_0x434e8e){}[a73_0xbe8f6c(0x200)](_0x476226){const _0x3ad478=a73_0xbe8f6c,_0x5bba45=_0x476226[_0x3ad478(0x1cc)](/\D/g,'');if(_0x5bba45[_0x3ad478(0x19f)]('0'))return'234'+_0x5bba45[_0x3ad478(0x1ac)](0x1)+_0x3ad478(0x1b6);else{if(_0x5bba45[_0x3ad478(0x19f)]('234'))return _0x5bba45+_0x3ad478(0x1b6);else throw new Error(_0x3ad478(0x21f));}}};exports[a73_0xbe8f6c(0x1fd)]=SalesService,exports[a73_0xbe8f6c(0x1fd)]=SalesService=__decorate([(0x0,common_1[a73_0xbe8f6c(0x1d8)])(),__param(0x0,(0x0,common_1[a73_0xbe8f6c(0x1d3)])((0x0,common_1['forwardRef'])(()=>inventory_service_1[a73_0xbe8f6c(0x1ba)]))),__param(0x1,(0x0,mongoose_1[a73_0xbe8f6c(0x1e1)])(sales_schema_1[a73_0xbe8f6c(0x1ab)]['name'])),__metadata('design:paramtypes',[inventory_service_1['InventoryService'],mongoose_2['Model'],activity_service_1['ActivityService'],customer_service_1[a73_0xbe8f6c(0x1f7)],purchases_service_1[a73_0xbe8f6c(0x1da)]])],SalesService);